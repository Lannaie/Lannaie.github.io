<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="获取每一个分组中的最大元素SQL12 获取每个部门中当前员工薪水最高的相关信息">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL刷题 &amp; 笔记">
<meta property="og:url" content="http://example.com/2021/07/09/SQL%E5%88%B7%E9%A2%98%20&%20%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="往南">
<meta property="og:description" content="获取每一个分组中的最大元素SQL12 获取每个部门中当前员工薪水最高的相关信息">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-07-09T02:24:47.000Z">
<meta property="article:modified_time" content="2022-04-04T09:13:14.039Z">
<meta property="article:author" content="Bonnie">
<meta property="article:tag" content="sql">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/07/09/SQL%E5%88%B7%E9%A2%98%20&%20%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SQL刷题 & 笔记 | 往南</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">往南</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/09/SQL%E5%88%B7%E9%A2%98%20&%20%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bonnie">
      <meta itemprop="description" content="每天都要做个人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="往南">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL刷题 & 笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-09 10:24:47" itemprop="dateCreated datePublished" datetime="2021-07-09T10:24:47+08:00">2021-07-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-04 17:13:14" itemprop="dateModified" datetime="2022-04-04T17:13:14+08:00">2022-04-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%B7%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">刷题</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="获取每一个分组中的最大元素"><a href="#获取每一个分组中的最大元素" class="headerlink" title="获取每一个分组中的最大元素"></a>获取每一个分组中的最大元素</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/4a052e3e1df5435880d4353eb18a91c6?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL12 获取每个部门中当前员工薪水最高的相关信息</a></p>
<span id="more"></span>

<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点"><a href="#1-知识点" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>要求获取每一个分组中的最大元素（也可以看作获取每个分组的第一个元素）。</p>
<p>错误的思考：在同一个语句中group by+order by - </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 错误</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a <span class="keyword">order</span> <span class="keyword">by</span> b</span><br></pre></td></tr></table></figure>

<p>原因：group by后显示的就会是每个分组的第一条数据；之后进行order by就是对每个分组的第一条数据进行排序，即组间排序，并没有意义。</p>
<p>分析：有一种方法是可以先order by limit再进行group by，但是这种方法不够灵活有效；还有一种方法就算下述，先获取每个分组的目标元素的最大值和目标分组的字段，然后联表获取所有所需字段和目标分组字段，将两个部分进行连接就可以了。</p>
<h4 id="2-具体题解"><a href="#2-具体题解" class="headerlink" title="2. 具体题解"></a>2. 具体题解</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> B1.dept_no</span><br><span class="line">      ,B2.emp_no</span><br><span class="line">      ,B1.maxSalary</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">        <span class="keyword">select</span> A1.dept_no, <span class="built_in">max</span>(A2.salary) <span class="keyword">as</span> maxSalary</span><br><span class="line">          <span class="keyword">from</span> dept_emp <span class="keyword">as</span> A1</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> salaries <span class="keyword">as</span> A2</span><br><span class="line">            <span class="keyword">on</span> A1.emp_no <span class="operator">=</span> A2.emp_no</span><br><span class="line">      <span class="keyword">group</span> <span class="keyword">by</span> A1.dept_no</span><br><span class="line">) B1</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">(</span><br><span class="line">        <span class="keyword">select</span> A1.dept_no, A1.emp_no, A2.salary</span><br><span class="line">          <span class="keyword">from</span> dept_emp <span class="keyword">as</span> A1</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> salaries <span class="keyword">as</span> A2</span><br><span class="line">            <span class="keyword">on</span> A1.emp_no <span class="operator">=</span> A2.emp_no</span><br><span class="line">) B2</span><br><span class="line">     <span class="keyword">on</span> B1.dept_no <span class="operator">=</span> B2.dept_no</span><br><span class="line">     <span class="keyword">and</span> B1.maxSalary <span class="operator">=</span> B2.salary</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> B1.dept_no</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/a32669eb1d1740e785f105fa22741d5c?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL15 查找employees表emp_no与last_name的员工信息</a></p>
<h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-1"><a href="#1-知识点-1" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>不相等的三种表达：<code>!=、&lt;&gt;、is not</code>；</p>
<p>求余：<code>%、MOD</code>；</p>
<p>判断是否为奇数：<code>val%2 = 1、val&amp;1</code>；</p>
<p>判断是否为偶数：<code>val = (val &gt;&gt; 1 &lt;&lt; 1)</code> - 即先右移一位再左移一位，如果是奇数，二进制最后一位一定是1，右移一位后再左移一位最后一个二进制数会补0而不是1，此时如果是奇数会与原值不等，如果是偶数会相等；</p>
<p>除法计算：默认 - <code>/</code>、取指定小数位 - <code>convert(val1 / val2, decimal(10, 2))</code> - 取两位小数，为0取整不保留小数、直接取整 - <code>val1 DIV val2</code>；</p>
<h4 id="2-具体代码"><a href="#2-具体代码" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span> employees</span><br><span class="line">   <span class="keyword">where</span> emp_no <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">     <span class="keyword">and</span> last_name <span class="operator">&lt;&gt;</span> &quot;Mary&quot;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> hire_date</span><br><span class="line">    <span class="keyword">desc</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">--或者</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span> employees</span><br><span class="line">   <span class="keyword">where</span> emp_no <span class="operator">&amp;</span> <span class="number">1</span></span><br><span class="line">     <span class="keyword">and</span> last_name <span class="operator">&lt;&gt;</span> &quot;Mary&quot;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> hire_date</span><br><span class="line">    <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="生成序号"><a href="#生成序号" class="headerlink" title="生成序号"></a>生成序号</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/b9068bfe5df74276bd015b9729eec4bf?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL23 对所有员工的薪水按照salary降序进行1-N的排名</a></p>
<h3 id="求解思路"><a href="#求解思路" class="headerlink" title="求解思路"></a>求解思路</h3><h4 id="1-知识点-2"><a href="#1-知识点-2" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><ol>
<li><code>row_number</code> - 生成连续唯一的序号，即序号不重复：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<blockquote>
<p>1</p>
<p>2</p>
<p>2</p>
<p>3</p>
</blockquote>
<ol start="2">
<li><code>rank</code> - 分区内排名，即一个分区的排名一致，但会产生间断：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<blockquote>
<p>1</p>
<p>2</p>
<p>2</p>
<p>4</p>
</blockquote>
<ol start="2">
<li><code>dense_rank</code> - 分区内排名，不会产生间断：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<blockquote>
<p>1</p>
<p>2</p>
<p>2</p>
<p>3</p>
</blockquote>
<ol start="2">
<li><code>ntile</code> - 按照指定的排序规则均分成指定数目的组</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ntile</span>(<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<blockquote>
<p>1</p>
<p>1</p>
<p>2</p>
<p>2</p>
</blockquote>
<h4 id="2-具体代码-1"><a href="#2-具体代码-1" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp_no</span><br><span class="line">       ,salary</span><br><span class="line">       ,<span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>) <span class="keyword">as</span> t_rank</span><br><span class="line">  <span class="keyword">from</span> salaries</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t_rank <span class="keyword">asc</span>, emp_no <span class="keyword">asc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="并集"><a href="#并集" class="headerlink" title="并集"></a>并集</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/979b1a5a16d44afaba5191b22152f64a?tpId=199&tags=&title=&difficulty=0&judgeStatus=0&rp=0">SQL25 查找山东大学或者性别为男生的信息</a></p>
<h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>这道题第一个想到的解法是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> university <span class="operator">=</span> <span class="string">&#x27;山东大学&#x27;</span> <span class="keyword">or</span> gender <span class="operator">=</span> <span class="string">&#x27;male&#x27;</span></span><br></pre></td></tr></table></figure>

<p>但是题目中有两个提示：</p>
<ol>
<li>结果不去重；</li>
<li>注意输出的顺序，先输出学校为山东大学再输出性别为男生的信息。</li>
</ol>
<p>从第一个提示看应该会有去不去重两种可能，这道题其实有两种思路：<code>or</code> 和 <code>union</code>。对于 <code>or</code> 肯定不会存在去不去重的问题，确定是 <code>union</code> 的关键是第二个提示，使用 <code>union</code> 方法都会默认 <code>union</code> 前的结果会放在 <code>union</code> 后的结果前。</p>
<p>去重的问题：union会去重，union all 不会去重。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> device_id, gender, age, gpa</span><br><span class="line">  <span class="keyword">from</span> user_profile</span><br><span class="line"> <span class="keyword">where</span> university <span class="operator">=</span> <span class="string">&#x27;山东大学&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> device_id, gender, age, gpa</span><br><span class="line">  <span class="keyword">from</span> user_profile</span><br><span class="line"> <span class="keyword">where</span> gender <span class="operator">=</span> <span class="string">&#x27;male&#x27;</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="insert-ignore-和-replace-into"><a href="#insert-ignore-和-replace-into" class="headerlink" title="insert ignore 和 replace into"></a>insert ignore 和 replace into</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/153c8a8e7805400ba8e384e03acc6b3e?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL35 批量插入数据，不使用replace操作</a></p>
<h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p><strong>主要是insert ignore 和 replace into 的区别：</strong></p>
<p>使用 <code>ignore</code> 关键字。</p>
<p><code>insert ignore</code>  - 如果数据库中不存在这条数据就插入，存在就跳过。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> </span><br><span class="line">ignore </span><br><span class="line">  <span class="keyword">into</span> actor </span><br><span class="line"><span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;ED&#x27;</span>, <span class="string">&#x27;CHASE&#x27;</span>, <span class="string">&#x27;2006-02-15 12:34:33&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>replace</code> 关键字。</p>
<p><code>replace into</code> - 如果存在 <code>primary key</code> 或 <code>unique</code> 相同的记录，先删除原有记录，再添加此新记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">replace </span><br><span class="line">   <span class="keyword">into</span> actor</span><br><span class="line"> <span class="keyword">select</span> <span class="number">3</span></span><br><span class="line">        ,<span class="string">&#x27;ED&#x27;</span></span><br><span class="line">        ,<span class="string">&#x27;CHASE&#x27;</span></span><br><span class="line">        ,<span class="string">&#x27;2006-02-15 12:34:33&#x27;</span></span><br><span class="line">   <span class="keyword">from</span> actor</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p><strong>ignore 和 replace 是mysql8之后有的内容。</strong></p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/e1824daa0c49404aa602cf0cb34bdd75?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL37 对first_name创建唯一索引uniq_idx_firstname</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/4963f6d63dde48d787aaa2b43460fb4b?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0"><strong>SQL13</strong> <strong>删除索引</strong></a></p>
<h3 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h3><h3 id="1-知识点-3"><a href="#1-知识点-3" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>有以下几种索引 <code>index</code> ：</p>
<ul>
<li>UNIQUE:可选。表示索引为唯一性索引。</li>
<li>FULLTEXT:可选。表示索引为全文索引。</li>
<li>SPATIAL:可选。表示索引为空间索引。</li>
<li>默认上述关键字都不加，表示索引为普通索引。</li>
</ul>
<p>添加索引的几种方式：</p>
<ol>
<li>创建表时添加：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    filename <span class="type">VARCHAR</span> (<span class="number">512</span>),</span><br><span class="line">    fileurl <span class="type">VARCHAR</span> (<span class="number">512</span>),</span><br><span class="line">    filesize <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="comment">-- 带关键字索引</span></span><br><span class="line">    <span class="keyword">unique</span> index (id),</span><br><span class="line">    <span class="comment">-- 普通索引</span></span><br><span class="line">    index (filename),</span><br><span class="line">    <span class="comment">--组合索引</span></span><br><span class="line">    index (fileurl, filesize)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为已有表添加：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 带关键字的索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test <span class="keyword">add</span> <span class="keyword">unique</span> index (id);</span><br><span class="line"><span class="comment">-- 不带关键字的索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test <span class="keyword">add</span> index (filename);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>删除索引：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> index index_name;</span><br></pre></td></tr></table></figure>



<h4 id="2-具体代码-2"><a href="#2-具体代码-2" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> actor <span class="keyword">add</span> <span class="keyword">unique</span> index uniq_idx_firstname (first_name);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> actor <span class="keyword">add</span> index idx_lastname (last_name);</span><br></pre></td></tr></table></figure>



<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/b9db784b5e3d488cbd30bd78fdb2a862?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL38 针对actor表创建视图actor_name_view</a></p>
<h3 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-4"><a href="#1-知识点-4" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>创建视图：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span></span><br></pre></td></tr></table></figure>

<p>查询视图：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> view_name;</span><br></pre></td></tr></table></figure>

<p>更新视图：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span></span><br></pre></td></tr></table></figure>

<p>撤销视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW view_name</span><br></pre></td></tr></table></figure>

<h4 id="2-具体解决代码"><a href="#2-具体解决代码" class="headerlink" title="2. 具体解决代码"></a>2. 具体解决代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> actor_name_view <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">select</span> first_name <span class="keyword">as</span> first_name_v</span><br><span class="line">       ,last_name <span class="keyword">as</span> last_name_v</span><br><span class="line">  <span class="keyword">from</span> actor;</span><br></pre></td></tr></table></figure>



<h2 id="强制使用索引"><a href="#强制使用索引" class="headerlink" title="强制使用索引"></a>强制使用索引</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f9fa9dc1a1fc4130b08e26c22c7a1e5f?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL39 强制使用索引</a></p>
<h3 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-5"><a href="#1-知识点-5" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>强制使用索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> TABLE1 FORCE INDEX (索引名或<span class="keyword">PRIMARY</span>) ;</span><br></pre></td></tr></table></figure>

<h4 id="2-具体代码-3"><a href="#2-具体代码-3" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> salaries FORCE INDEX (idx_emp_no) <span class="keyword">where</span> emp_no <span class="operator">=</span> <span class="number">10005</span>;</span><br></pre></td></tr></table></figure>



<h2 id="给已有表新建列"><a href="#给已有表新建列" class="headerlink" title="给已有表新建列"></a>给已有表新建列</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/119f04716d284cb7a19fba65dd876b03?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL40 在指定列后添加新列</a></p>
<h3 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-6"><a href="#1-知识点-6" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">alter</span> </span><br><span class="line">  <span class="keyword">table</span> table_name</span><br><span class="line">    <span class="keyword">add</span></span><br><span class="line"> <span class="keyword">COLUMN</span> column_name column_type [<span class="keyword">not</span> <span class="keyword">NULL</span>]</span><br><span class="line">[<span class="keyword">DEFAULT</span> default_context]</span><br><span class="line">[  after column_name]</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>其中，<code>after</code> 用来指定在某个列后面添加新列，<code>default</code> 指定默认值。</p>
<h4 id="2-具体代码-4"><a href="#2-具体代码-4" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">alter</span> </span><br><span class="line">  <span class="keyword">table</span> actor</span><br><span class="line">    <span class="keyword">add</span></span><br><span class="line"> <span class="keyword">COLUMN</span> create_date datetime <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">DEFAULT</span> <span class="string">&#x27;2020-10-01 00:00:00&#x27;</span></span><br><span class="line">  after last_update</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/7e920bb2e1e74c4e83750f5c16033e2e?tpId=82&&tqId=29809&rp=1&ru=/activity/oj&qru=/ta/sql/question-ranking">SQL41 构造一个触发器</a></p>
<h3 id="解题思路-8"><a href="#解题思路-8" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-7"><a href="#1-知识点-7" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>Trigger创建的语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">       trigger_time trigger_event </span><br><span class="line">    <span class="keyword">ON</span> tbl_name</span><br><span class="line">   <span class="keyword">FOR</span> </span><br><span class="line">  <span class="keyword">EACH</span> </span><br><span class="line">   <span class="type">ROW</span></span><br><span class="line">       trigger_stmt</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<blockquote>
<p><strong>参数解析</strong></p>
<p>trigger_name：标识触发器名称，用户自行指定；<br>trigger_time：标识触发时机，取值为 BEFORE 或 AFTER；<br>trigger_event：标识触发事件，取值为 INSERT、UPDATE 或 DELETE；<br>tbl_name：标识建立触发器的表名，即在哪张表上建立触发器；<br>trigger_stmt：触发器程序体，可以是一句SQL语句，或者用 BEGIN 和 END 包含的多条语句，每条语句结束要分号结尾。</p>
<p><strong>new 和 old</strong></p>
<p>MySQL 中定义了 NEW 和 OLD，用来表示触发器的所在表中，触发了触发器的那一行数据。<br>具体地：</p>
<ol>
<li>在 INSERT 型触发器中，NEW 用来表示将要（BEFORE）或已经（AFTER）插入的新数据；</li>
<li>在 UPDATE 型触发器中，OLD 用来表示将要或已经被修改的原数据，NEW 用来表示将要或已经修改为的新数据；</li>
<li>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；</li>
<li>使用方法： NEW.columnName （columnName 为相应数据表某一列名）</li>
</ol>
</blockquote>
<h4 id="2-具体代码-5"><a href="#2-具体代码-5" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">create</span> </span><br><span class="line">     <span class="keyword">trigger</span> audit_log</span><br><span class="line">       after </span><br><span class="line">      <span class="keyword">insert</span> </span><br><span class="line">          <span class="keyword">on</span> employees_test</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">             <span class="keyword">insert</span> <span class="keyword">into</span> audit <span class="keyword">values</span>(new.ID, new.NAME);</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h4 id="3-摘自"><a href="#3-摘自" class="headerlink" title="3. 摘自"></a>3. 摘自</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/haut_ykc/article/details/110226668">SQL编程：构造触发器</a></p>
<h2 id="表的更新和删除"><a href="#表的更新和删除" class="headerlink" title="表的更新和删除"></a>表的更新和删除</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/3d92551a6f6d4f1ebde272d20872cf05?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL42 对表进行条件删除</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/859f28f43496404886a77600ea68ef59?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL43 对表进行条件更新</a></p>
<h3 id="解题思路-9"><a href="#解题思路-9" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-8"><a href="#1-知识点-8" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>删除语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name [<span class="keyword">WHERE</span> Clause]</span><br></pre></td></tr></table></figure>

<p>更新语法：</p>
<ol>
<li>设置为新值：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name <span class="keyword">SET</span> field1<span class="operator">=</span><span class="keyword">new</span><span class="operator">-</span>value1, field2<span class="operator">=</span><span class="keyword">new</span><span class="operator">-</span>value2</span><br><span class="line">[<span class="keyword">WHERE</span> Clause]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>根据已有值替换：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name <span class="keyword">SET</span> key1<span class="operator">=</span>replace(key1, <span class="string">&#x27;查找内容&#x27;</span>, <span class="string">&#x27;替换成内容&#x27;</span>)</span><br><span class="line">[<span class="keyword">WHERE</span> Clause]</span><br></pre></td></tr></table></figure>

<h4 id="2-具体代码-6"><a href="#2-具体代码-6" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> titles_test</span><br><span class="line"><span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="built_in">min</span>(id)</span><br><span class="line">        <span class="keyword">from</span> titles_test</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> emp_no</span><br><span class="line">    )A1</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--更新</span></span><br><span class="line">UPDATE titles_test</span><br><span class="line">   <span class="keyword">SET</span> to_date<span class="operator">=</span><span class="keyword">NULL</span></span><br><span class="line">       ,from_date<span class="operator">=</span><span class="string">&#x27;2001-01-01&#x27;</span></span><br><span class="line"> <span class="keyword">WHERE</span> to_date <span class="operator">=</span> <span class="string">&#x27;9999-01-01&#x27;</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>这里有一个犯过的错误：</p>
<p><strong>group by前面的select语句中要用聚合函数！！！不然是没有作用的。</strong></p>
<h2 id="alter和update"><a href="#alter和update" class="headerlink" title="alter和update"></a>alter和update</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/5277d7f92aa746ab8aa42886e5d570d4?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL44 alter</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/2bec4d94f525458ca3d0ebf3bc8cd240?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL45 update</a></p>
<h3 id="解题思路-10"><a href="#解题思路-10" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-9"><a href="#1-知识点-9" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>update和alter的<strong>区别</strong>：</p>
<p>alter 是DDL语句，是修改数据库中对象（表，数据库，视图。。）的语句；update是DML语句，是修改表中数据的语句。</p>
<p>alter中：</p>
<p>（1）添加列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">        <span class="keyword">ADD</span> column_name column_type</span><br><span class="line">           [, column_name colum_type ...];</span><br></pre></td></tr></table></figure>

<p>（2）删除列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">       <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name;</span><br></pre></td></tr></table></figure>

<p>（3）改变数据类型：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> column_name column_type;</span><br></pre></td></tr></table></figure>

<p>（4）修改表名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> old_name</span><br><span class="line">  RENAME <span class="keyword">TO</span> new_name;</span><br></pre></td></tr></table></figure>

<p>（5）同时修改字段名和数据类型：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">CHANGE <span class="keyword">COLUMN</span> old_column_name new_column_name new_column_type;</span><br></pre></td></tr></table></figure>



<p>update中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name </span><br><span class="line">   <span class="keyword">SET</span> field1<span class="operator">=</span><span class="keyword">new</span><span class="operator">-</span>value1, field2<span class="operator">=</span><span class="keyword">new</span><span class="operator">-</span>value2</span><br><span class="line">[<span class="keyword">WHERE</span> Clause]</span><br></pre></td></tr></table></figure>

<p>特殊的，题中出现替代值,这就用到了 <code>replace函数</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(<span class="keyword">column</span>, old_value, new_value)</span><br></pre></td></tr></table></figure>

<p>出现在 <code>update</code> 也是一样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">set</span> column_name <span class="operator">=</span> replace(column_name, <span class="keyword">old</span>, <span class="keyword">new</span>)</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<h4 id="2-具体代码-7"><a href="#2-具体代码-7" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- sql44</span></span><br><span class="line"> UPDATE titles_test </span><br><span class="line">    <span class="keyword">SET</span> emp_no <span class="operator">=</span> REPLACE(emp_no, <span class="number">10001</span>, <span class="number">10005</span>)</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">--sql45</span></span><br><span class="line"> <span class="keyword">alter</span> </span><br><span class="line"> <span class="keyword">table</span> titles_test </span><br><span class="line">rename </span><br><span class="line">    <span class="keyword">to</span> titles_2017</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat"></a>group_concat</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/6e86365af15e49d8abe2c3d4b5126e87?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL53 按照dept_no进行汇总</a></p>
<h3 id="解题思路-11"><a href="#解题思路-11" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-10"><a href="#1-知识点-10" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p><code>group_concat(column, delim)</code></p>
<p>将聚合后的字段进行连接， <code>delim</code> 参数默认是 <code>,</code> 逗号。</p>
<h4 id="2-具体代码-8"><a href="#2-具体代码-8" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">select</span> dept_no</span><br><span class="line">         ,GROUP_CONCAT(emp_no)</span><br><span class="line">    <span class="keyword">from</span> dept_emp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_no;</span><br></pre></td></tr></table></figure>



<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f24966e0cb8a49c192b5e65339bc8c03?tpId=82&tags=&title=&difficulty=0&judgeStatus=0&rp=1">SQL55 分页查询employees表，每5行一页，返回第2页的数据</a></p>
<h3 id="解题思路-12"><a href="#解题思路-12" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-11"><a href="#1-知识点-11" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p><strong>分页查询。每页n行，取第k页的全部数据。</strong></p>
<h4 id="1-limit进行分页"><a href="#1-limit进行分页" class="headerlink" title="1. limit进行分页"></a>1. limit进行分页</h4><p>公式：<code>limit n * (k - 1), n </code></p>
<p>具体代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> emp_no</span><br><span class="line">limit <span class="number">5</span>,<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>在具体代码中，<strong>limit后不支持计算</strong>。</p>
<h4 id="2-row-number实现分页查询"><a href="#2-row-number实现分页查询" class="headerlink" title="2. row_number实现分页查询"></a>2. row_number实现分页查询</h4><p>具体代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp_no,birth_date,first_name,last_name,gender,hire_date</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">       ,<span class="built_in">floor</span>(rn <span class="operator">/</span> <span class="number">5</span>) <span class="keyword">as</span> dr</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> e.<span class="operator">*</span></span><br><span class="line">       ,<span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> emp_no) <span class="operator">-</span> <span class="number">1</span> <span class="keyword">as</span> rn</span><br><span class="line">  <span class="keyword">from</span> employees e</span><br><span class="line">)e1</span><br><span class="line">)e2 <span class="keyword">where</span> dr <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>思路是：</p>
<ol>
<li>首先对整体数据添加序号：<code>row_number() over</code> 至少需要用 <code>order by</code> 进行排序；</li>
<li>先使用 <code>rn / 5</code> 对数据分页，已知 <code>0/5 == 1/5 == 2/5 == 3/5 == 4/5 == 0</code>（仅整数部分），但是由于此处的计算结果是小数，使用 <code>floor()</code> 函数向下取整。</li>
<li>最终取分页值为 <code>(k-1)</code> 的数据即可。</li>
</ol>
<h2 id="切分字符串"><a href="#切分字符串" class="headerlink" title="切分字符串"></a>切分字符串</h2><p><a href="%5Bhttps://www.nowcoder.com/practice/f04189f92f8d4f6fa0f383d413af7cb8?tpId=199&tqId=1975682&ru=/exam/oj&qru=/ta/sql-quick-study/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=199%5D(https://www.nowcoder.com/practice/f04189f92f8d4f6fa0f383d413af7cb8?tpId=199&tqId=1975682&ru=/exam/oj&qru=/ta/sql-quick-study/question-ranking&sourceUrl=/exam/oj?tab=SQL%E7%AF%87&topicId=199)">SQL30 统计每种性别的人数</a></p>
<h3 id="解题思路-13"><a href="#解题思路-13" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="1-知识点-12"><a href="#1-知识点-12" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>使用 <code>SUBSTRING_INDEX(str, delim, pos)</code>。</p>
<h4 id="2-具体代码-9"><a href="#2-具体代码-9" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> SUBSTRING_INDEX(profile, <span class="string">&#x27;,&#x27;</span>, <span class="number">-1</span>) gender</span><br><span class="line">  <span class="keyword">from</span> user_submit</span><br><span class="line">)A</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> gender</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="表中记录替换"><a href="#表中记录替换" class="headerlink" title="表中记录替换"></a>表中记录替换</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/978bcee6530a430fb0be716423d84082?tpId=240&tqId=2223554&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240">SQL3 插入记录（三）</a></p>
<h3 id="1-知识点-13"><a href="#1-知识点-13" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>可以先删除 <code>delete</code> ，再添加。</p>
<p>也可以直接使用 <code>replace</code> 关键字替换。</p>
<h3 id="2-具体代码-10"><a href="#2-具体代码-10" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># replace <span class="keyword">into</span> examination_info <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="number">9003</span>, <span class="string">&#x27;SQL&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;2021-01-01 00:00:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> examination_info <span class="keyword">where</span> exam_id <span class="operator">=</span> <span class="number">9003</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> examination_info <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="number">9003</span>, <span class="string">&#x27;SQL&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;2021-01-01 00:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="日期相减"><a href="#日期相减" class="headerlink" title="日期相减"></a>日期相减</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/d331359c5ca04a3b87f06b97da42159c?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0">SQL6删除记录（一）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/9dcc0eebb8394e79ada1d4d4e979d73c?tpId=240&tqId=2183405&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL29</strong> <strong>连续两次作答试卷的最大时间窗</strong></a></p>
<h3 id="1-知识点-14"><a href="#1-知识点-14" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><ul>
<li>TIMESTAMPDIFF(interval, time_start, time_end)可计算time_start-time_end的时间差，单位以指定的interval为准，常用可选：<ul>
<li>SECOND 秒</li>
<li>MINUTE 分钟（返回秒数差除以60的整数部分）</li>
<li>HOUR 小时（返回秒数差除以3600的整数部分）</li>
<li>DAY 天数（返回秒数差除以3600*24的整数部分）</li>
<li>MONTH 月数</li>
<li>YEAR 年数</li>
</ul>
</li>
<li>DATEDIFF(next_date, cur_date)返回两个日期间的<strong>天数</strong>。</li>
</ul>
<h3 id="2-具体代码-11"><a href="#2-具体代码-11" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> exam_record </span><br><span class="line"> <span class="keyword">where</span> TIMESTAMPDIFF(<span class="keyword">MINUTE</span>, start_time, submit_time) <span class="operator">&lt;</span> <span class="number">5</span> </span><br><span class="line">   <span class="keyword">and</span> score <span class="operator">&lt;</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure>



<h2 id="删除表中所有记录并重置自增主键"><a href="#删除表中所有记录并重置自增主键" class="headerlink" title="删除表中所有记录并重置自增主键"></a>删除表中所有记录并重置自增主键</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/3abefc6fc73e4f219dad0ab66e6b1e3f?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0"><strong>SQL8</strong> <strong>删除记录（三）</strong></a></p>
<h3 id="1-知识点-15"><a href="#1-知识点-15" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>truncate删除表中的所有行,但表结构及其列、约束、索引等保持不变。新行标识所用的计数值<strong>重置</strong>为该列的种子。也就是<strong>truncate可以删除所有记录以及重置自增主键。</strong></p>
<h3 id="2-具体代码-12"><a href="#2-具体代码-12" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> exam_record;</span><br></pre></td></tr></table></figure>



<h2 id="创建自增主键和唯一键"><a href="#创建自增主键和唯一键" class="headerlink" title="创建自增主键和唯一键"></a>创建自增主键和唯一键</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/a61ee5519d14444aa99e530309a8e043?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0"><strong>SQL9</strong> <strong>创建一张新表</strong></a></p>
<h3 id="1-知识点-16"><a href="#1-知识点-16" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>自增关键字：<code>auto_increment</code>；唯一关键字：<code>unique</code>；注释：<code>comment</code>。</p>
<h3 id="2-具体代码-13"><a href="#2-具体代码-13" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> user_info_vip</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;自增ID&#x27;</span>,</span><br><span class="line">    uid <span class="type">int</span> <span class="keyword">unique</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">    nick_name <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">    achievement <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;成就值&#x27;</span>,</span><br><span class="line">    level <span class="type">int</span> comment <span class="string">&#x27;用户等级&#x27;</span>,</span><br><span class="line">    job <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;职业方向&#x27;</span>,</span><br><span class="line">    register_time datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;注册时间&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="日期匹配"><a href="#日期匹配" class="headerlink" title="日期匹配"></a>日期匹配</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/9e2fb674b58b4f60ac765b7a37dde1b9?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0"><strong>SQL17</strong> <strong>平均活跃天数和月活人数</strong></a></p>
<h3 id="1-知识点-17"><a href="#1-知识点-17" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p><code>date_format(date_, &quot;%Y%m%d&quot;)</code> 格式匹配字符串。具体匹配字符参照 <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/sql/func_date_format.asp">此文章</a>。</p>
<p><code>year(date_)</code> 取日期中的年份。类似的有：</p>
<ol>
<li><code>month()</code> 获取月份；</li>
<li><code>dayofmonth()</code>显示日期；</li>
<li><code>day()</code> 显示天；</li>
<li><code>last_day()</code> 显示所传日期的最后一天。</li>
</ol>
<h3 id="2-具体代码-14"><a href="#2-具体代码-14" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><p>注意题意，用户平均月活跃天数的计算应该是有 m 个人，活跃了 n 天，然后 n &#x2F; m 就是平均月活跃天数。那么这个 m 个人应该取 <code>distinct</code> ，而活跃 n 天应该取 <code>distinct 人+天</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> date_format(submit_time, &quot;%Y%m&quot;), </span><br><span class="line">       round(<span class="built_in">count</span>(<span class="keyword">distinct</span> uid, DATE_FORMAT(submit_time, &quot;%Y%m%d&quot;)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> uid), <span class="number">2</span>), </span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">distinct</span> uid)</span><br><span class="line"><span class="keyword">from</span> exam_record </span><br><span class="line"><span class="keyword">where</span> submit_time <span class="keyword">like</span> &quot;2021%&quot; <span class="keyword">and</span> score <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> date_format(submit_time, &quot;%Y%m&quot;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="some、all、any的用法"><a href="#some、all、any的用法" class="headerlink" title="some、all、any的用法"></a>some、all、any的用法</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-ii/">512. 游戏玩法分析 II</a></p>
<h3 id="1-知识点-18"><a href="#1-知识点-18" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p><a target="_blank" rel="noopener" href="https://github.com/astak16/blog-mysql/issues/19">借鉴</a></p>
<p>这三个关键字是子查询的关键词之一，必须和比较操作符一起使用。</p>
<ol>
<li>any和some：和子查询返回的列中任一值比较为true，返回true。二者的区别在于，在 <code>!=</code> 的场景下，使用some更容易理解。</li>
<li>all：和子查询返回的列中的所有值比较为true，返回true。</li>
</ol>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1 (id <span class="type">int</span>, <span class="keyword">value</span> <span class="type">int</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2 (id <span class="type">int</span>, <span class="keyword">value</span> <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">10</span>), (<span class="number">2</span>, <span class="number">300</span>), (<span class="number">3</span>, <span class="number">40</span>), (<span class="number">4</span>, <span class="number">60</span>), (<span class="number">5</span>, <span class="number">70</span>), (<span class="number">6</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">100</span>), (<span class="number">2</span>, <span class="number">300</span>), (<span class="number">3</span>, <span class="number">40</span>), (<span class="number">4</span>, <span class="number">600</span>), (<span class="number">5</span>, <span class="number">70</span>), (<span class="number">6</span>, <span class="number">800</span>);</span><br></pre></td></tr></table></figure>

<h4 id="all："><a href="#all：" class="headerlink" title="all："></a>all：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">value</span> <span class="operator">&lt;=</span> <span class="keyword">all</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> t2</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>子查询 <code>t2</code> 的结果返回 <code>(100,300,40,600,70,800)</code> ，当 <code>t1.value = 10</code> 是 <code>&lt;=</code> 子查询的所有结果，返回 <code>true</code> ；<code>t1.value = 300</code>  并没有 <code>&lt;=</code> 子查询的所有结果，如 <code>100</code> ，返回 <code>false</code> 。</p>
<h5 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h5><ul>
<li>如果子查询中结果为 <strong>空</strong>，结果为 <code>true</code></li>
<li>如果有一条数据为 <code>null</code> ，结果为 <code>false</code> ，也就是说查不出结果</li>
<li>如果有所有数据为 <code>null</code> ，结果为 <code>false</code> ，和结果为空不是一个概念</li>
</ul>
<h4 id="any："><a href="#any：" class="headerlink" title="any："></a>any：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">value</span> <span class="operator">&lt;=</span> <span class="keyword">any</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> t2</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>如上，子查询结果为 <code>(100,300,40,600,70,800)</code> ，当 <code>t1.value = 10 &lt;=</code> 子查询列表中的 <code>100</code>，返回true；<code>t1.value = 300 &lt;=</code> 子查询列表中的 <code>600</code> ，返回 <code>true</code> 。</p>
<h5 id="tips："><a href="#tips：" class="headerlink" title="tips："></a>tips：</h5><ul>
<li>如果子查询中结果为 <strong>空</strong>，结果为 <code>false</code>，也就是说查不出结果</li>
<li>如果子查询中所有结果都为 <code>null</code> ，结果为 <code>false</code></li>
</ul>
<h4 id="some："><a href="#some：" class="headerlink" title="some："></a>some：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">value</span> <span class="operator">!=</span> <span class="keyword">some</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> t2</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>t1</code> 列表与 <code>t2</code> 列表有部分数据不相等；或者从 <code>any</code> 来看，<code>t1</code> 列表的值与 <code>t2</code> 列表的任意值不相等，二者结果相等。</p>
<h3 id="2-具体代码-15"><a href="#2-具体代码-15" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"># <span class="number">1.</span></span><br><span class="line"># <span class="keyword">select</span> A.player_id, B.device_id <span class="keyword">from</span> Activity B <span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line"># (</span><br><span class="line">#     <span class="keyword">select</span> player_id, <span class="built_in">min</span>(event_date) first_login <span class="keyword">from</span> Activity <span class="keyword">group</span> <span class="keyword">by</span> player_id</span><br><span class="line"># )A</span><br><span class="line"># <span class="keyword">on</span> A.player_id <span class="operator">=</span> B.player_id <span class="keyword">and</span> B.event_date <span class="operator">=</span> A.first_login;</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span></span><br><span class="line"># <span class="keyword">select</span> player_id, device_id <span class="keyword">from</span></span><br><span class="line"># (</span><br><span class="line">#     <span class="keyword">select</span> player_id, device_id, <span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) num</span><br><span class="line">#     <span class="keyword">from</span> Activity</span><br><span class="line"># )A</span><br><span class="line"># <span class="keyword">where</span> num <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span></span><br><span class="line"><span class="keyword">select</span> player_id, device_id <span class="keyword">from</span> Activity A2 <span class="keyword">where</span> A2.event_date <span class="operator">&lt;=</span></span><br><span class="line"><span class="keyword">all</span>(</span><br><span class="line">    <span class="keyword">select</span> event_date <span class="keyword">from</span> Activity A1 <span class="keyword">where</span> A1.player_id <span class="operator">=</span> A2.player_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="over-函数的使用"><a href="#over-函数的使用" class="headerlink" title="over() 函数的使用"></a>over() 函数的使用</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-iii/">534. 游戏玩法分析 III</a></p>
<h3 id="1-知识点-19"><a href="#1-知识点-19" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43725031/article/details/104785986">借鉴</a></p>
<p><code>over(partition by ... order by ...)</code> 函数不能单独使用，要和分析函数一起使用。</p>
<p>常见的分析函数如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组排序</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组排序</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组排序</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">count</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组计数</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">max</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...) 		<span class="comment">--分组取最大值</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">min</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span>    ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组取最小值</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">sum</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组求和</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">avg</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--分组取平均值</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">first_value</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--取分组第一条</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">last_value</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)			<span class="comment">--取分组最后一条</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">lag</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--取出同一字段的前N行的数据</span></span><br><span class="line"><span class="operator">-</span> <span class="built_in">lead</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ... <span class="keyword">order</span> <span class="keyword">by</span> ...)		<span class="comment">--取出同一字段的前N行的数据</span></span><br></pre></td></tr></table></figure>

<h3 id="2-具体代码-16"><a href="#2-具体代码-16" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><h4 id="和-sum-的连用"><a href="#和-sum-的连用" class="headerlink" title="和 sum()的连用"></a>和 sum()的连用</h4><p>此处和 <code>sum()</code> 函数连用，实现逐层累加。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id, </span><br><span class="line">       event_date, </span><br><span class="line">       <span class="built_in">sum</span>(games_played) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> player_id, event_date <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>这道题的常规解法是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> A.player_id, B.event_date, <span class="built_in">sum</span>(A.games_played) <span class="keyword">as</span> games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity A <span class="keyword">inner</span> <span class="keyword">join</span> Activity B</span><br><span class="line"><span class="keyword">on</span> A.player_id <span class="operator">=</span> B.player_id </span><br><span class="line"><span class="keyword">where</span> A.event_date <span class="operator">&lt;=</span> B.event_date</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> A.player_id, B.event_date</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> A.player_id, A.event_date <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>此处有一个可能没有考虑到的点：就是这里取的 <code>event_date</code> 应该是 <code>&lt;=</code> 后的变量或 <code>&gt;=</code> 前的变量。</p>
<h4 id="和min-的连用，和-datediff函数的嵌套"><a href="#和min-的连用，和-datediff函数的嵌套" class="headerlink" title="和min()的连用，和 datediff函数的嵌套"></a>和min()的连用，和 datediff函数的嵌套</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-iv/">550. 游戏玩法分析 IV</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">round((<span class="keyword">select</span> <span class="built_in">count</span>(player_id) <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> player_id, datediff(event_date, <span class="built_in">min</span>(event_date) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id)) date_diff</span><br><span class="line">    <span class="keyword">from</span> Activity</span><br><span class="line">)A <span class="keyword">where</span> date_diff <span class="operator">=</span> <span class="number">1</span>) <span class="operator">/</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> player_id), <span class="number">2</span>) fraction</span><br><span class="line"><span class="keyword">from</span> Activity;</span><br></pre></td></tr></table></figure>



<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><h3 id="字符串连接函数（普通连接和组内连接）"><a href="#字符串连接函数（普通连接和组内连接）" class="headerlink" title="字符串连接函数（普通连接和组内连接）"></a>字符串连接函数（普通连接和组内连接）</h3><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/46cb7a33f7204f3ba7f6536d2fc04286?tpId=240&tqId=2183007&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL19</strong> <strong>未完成试卷数大于1的有效用户</strong></a></p>
<h4 id="1-知识点-20"><a href="#1-知识点-20" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p><strong>（1）concat(str1, str2, str3, …)</strong> </p>
<p>不能专门指定分隔符，默认逗号连接。</p>
<p><strong>（2）concat_ws(sep, str1, str2, …)</strong></p>
<p><code>sep</code> 指定分隔符，默认逗号连接。</p>
<p>如本例中使用：<code>CONCAT_WS(&quot;:&quot;, date_format(A.start_time, &quot;%Y-%m-%d&quot;), B.tag)</code></p>
<p><strong>（3）group_concat([DISTINCT] 要连接的字段 [Order BY ASC&#x2F;DESC 排序字段] [Separator ‘分隔符’])</strong></p>
<p>如本例中使用的：<code>GROUP_CONCAT(distinct date_tag SEPARATOR &quot;;&quot;)</code></p>
<h4 id="2-具体代码-17"><a href="#2-具体代码-17" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> uid, incomplete_cnt, complete_cnt, GROUP_CONCAT(<span class="keyword">distinct</span> date_tag SEPARATOR &quot;;&quot;) detail</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> A.uid, </span><br><span class="line">       A.incomplete_cnt, </span><br><span class="line">       A.complete_cnt,</span><br><span class="line">       CONCAT_WS(&quot;:&quot;, date_format(A.start_time, &quot;%Y-%m-%d&quot;), B.tag) date_tag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line"># 获取有效用户</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> uid, exam_id, start_time, complete_cnt, incomplete_cnt</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> uid, exam_id, start_time,</span><br><span class="line">               <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> submit_time <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> uid) complete_cnt,</span><br><span class="line">               <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> submit_time <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> uid) incomplete_cnt</span><br><span class="line">        <span class="keyword">from</span> exam_record</span><br><span class="line">        <span class="keyword">where</span> <span class="keyword">year</span>(start_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">    )A </span><br><span class="line">    <span class="keyword">where</span> complete_cnt <span class="operator">&gt;=</span> <span class="number">1</span> <span class="keyword">and</span> incomplete_cnt <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line">) A</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> examination_info B <span class="keyword">on</span> A.exam_id <span class="operator">=</span> B.exam_id <span class="keyword">and</span> A.incomplete_cnt <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">)A</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> uid, incomplete_cnt, complete_cnt</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> incomplete_cnt <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>注意，获取未完成应该判断字段 <code>submit_time</code> 是否为 null，因为未完成的答卷也可能会有分数。</p>
<h3 id="left"><a href="#left" class="headerlink" title="left()"></a>left()</h3><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/203d0aed8928429a8978185d9a03babc?tpId=240&tqId=2183297&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL23</strong> <strong>每个题目和每份试卷被作答的人数和次数</strong></a></p>
<h4 id="1-知识点-21"><a href="#1-知识点-21" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p>返回字符串左边指定长度的子串。</p>
<p>语法：<code>LEFT(str,length);</code></p>
<p>其中，<code>str</code>是是被提取的字符串，<code>length</code> 指定提取的长度。</p>
<p><code>length</code> 是正整数，<code>&lt;= 0</code> 返回空字符串，<code>null</code> 返回 <code>NULL</code> ，指定长度大于字符串本身的长度，返回整个字符串。</p>
<h4 id="2-具体代码-18"><a href="#2-具体代码-18" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 试卷</span><br><span class="line"><span class="keyword">select</span> exam_id tid, <span class="built_in">count</span>(<span class="keyword">distinct</span> uid) uv, <span class="built_in">count</span>(<span class="operator">*</span>) pv</span><br><span class="line"><span class="keyword">from</span> exam_record </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> exam_id</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"># 做题</span><br><span class="line"><span class="keyword">select</span> question_id tid, <span class="built_in">count</span>(<span class="keyword">distinct</span> uid) uv, <span class="built_in">count</span>(<span class="operator">*</span>) pv</span><br><span class="line"><span class="keyword">from</span> practice_record </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> question_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">left</span>(tid, <span class="number">1</span>) <span class="keyword">desc</span>, uv <span class="keyword">desc</span>, pv <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>



<h3 id="空值匹配"><a href="#空值匹配" class="headerlink" title="空值匹配"></a>空值匹配</h3><h4 id="1-知识点-22"><a href="#1-知识点-22" class="headerlink" title="1. 知识点"></a>1. 知识点</h4><p><code>COALESCE(v1, v2, v3, ...)</code> 可以传入多个数值，会返回第一个不为 null 的数值。</p>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/a32c7c8590324c96950417c57fa6ecd1?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0"><strong>SQL26</strong> <strong>每个6&#x2F;7级用户活跃情况</strong></a></p>
<h4 id="2-具体代码-19"><a href="#2-具体代码-19" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> A.uid</span><br><span class="line">       ,<span class="built_in">COALESCE</span>(B.act_month_total, <span class="number">0</span>) act_month_total</span><br><span class="line">       ,<span class="built_in">COALESCE</span>(B.act_days_2021, <span class="number">0</span>) act_days_2021</span><br><span class="line">       ,<span class="built_in">COALESCE</span>(B.act_days_2021_exam, <span class="number">0</span>) act_days_2021_exam</span><br><span class="line">       ,<span class="built_in">COALESCE</span>(B.act_days_2021_question, <span class="number">0</span>) act_days_2021_question</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid <span class="keyword">from</span> user_info <span class="keyword">where</span> level <span class="keyword">in</span> (<span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line">) A <span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="keyword">distinct</span> DATE_FORMAT(act_time, &quot;%Y%m&quot;)) act_month_total# 总活跃月份数</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">year</span>(act_time) <span class="operator">=</span> <span class="number">2021</span> </span><br><span class="line">                       <span class="keyword">then</span> date_format(act_time, &quot;%Y%m%d&quot;) </span><br><span class="line">                       <span class="keyword">end</span>) act_days_2021# <span class="number">2021</span>年活跃天数</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> tb <span class="operator">=</span> &quot;exam&quot; <span class="keyword">and</span> <span class="keyword">year</span>(act_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">                       <span class="keyword">then</span> date_format(act_time, &quot;%Y%m%d&quot;) </span><br><span class="line">                       <span class="keyword">end</span>) act_days_2021_exam# <span class="number">2021</span>年试卷作答活跃天数</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> tb <span class="operator">=</span> &quot;prac&quot; <span class="keyword">and</span> <span class="keyword">year</span>(act_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">                       <span class="keyword">then</span> date_format(act_time, &quot;%Y%m%d&quot;)</span><br><span class="line">                       <span class="keyword">end</span>) act_days_2021_question# <span class="number">2021</span>年答题活跃天数</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> uid, start_time act_time, &quot;exam&quot; tb <span class="keyword">from</span> exam_record</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> uid, submit_time act_time, &quot;prac&quot; tb <span class="keyword">from</span> practice_record</span><br><span class="line">) A</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> uid</span><br><span class="line">) B <span class="keyword">on</span> A.uid <span class="operator">=</span> B.uid</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> act_month_total <span class="keyword">desc</span>, act_days_2021 <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="获取当前行数据的前n行或后n行"><a href="#获取当前行数据的前n行或后n行" class="headerlink" title="获取当前行数据的前n行或后n行"></a>获取当前行数据的前n行或后n行</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/9dcc0eebb8394e79ada1d4d4e979d73c?tpId=240&tqId=2183405&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL29</strong> <strong>连续两次作答试卷的最大时间窗</strong></a></p>
<h3 id="1-知识点-23"><a href="#1-知识点-23" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>当前行数据的前n行：<code>lead(col, n)</code>；</p>
<p>当前行数据的后n行：<code>lag(col, n)</code> 。</p>
<h3 id="2-具体代码-20"><a href="#2-具体代码-20" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 最大时间窗</span><br><span class="line"><span class="keyword">select</span> uid, days_window, round(exam_cnt <span class="operator">/</span> diff_day <span class="operator">*</span> days_window, <span class="number">2</span>) avg_exam_cnt</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,<span class="built_in">count</span>(start_time) exam_cnt</span><br><span class="line">       ,datediff(<span class="built_in">max</span>(next_time), <span class="built_in">min</span>(start_time)) <span class="operator">+</span> <span class="number">1</span> diff_day</span><br><span class="line">       ,<span class="built_in">max</span>(DATEDIFF(next_time, start_time)) <span class="operator">+</span> <span class="number">1</span> days_window</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,start_time</span><br><span class="line">       ,<span class="built_in">lead</span>(start_time, <span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> uid <span class="keyword">order</span> <span class="keyword">by</span> start_time) next_time</span><br><span class="line"><span class="keyword">from</span> exam_record </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(start_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">) A </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> uid</span><br><span class="line">)A</span><br><span class="line"><span class="keyword">where</span> diff_day <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> days_window <span class="keyword">desc</span>, avg_exam_cnt <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="row-number-和-dense-rank-的选择"><a href="#row-number-和-dense-rank-的选择" class="headerlink" title="row_number() 和 dense_rank() 的选择"></a>row_number() 和 dense_rank() 的选择</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/3e598a2dcd854db8b1a3c48e5904fe1c?tpId=240&tqId=2183408&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240">SQL31 未完成率较高的50%用户近三个月答卷情况</a></p>
<h3 id="1-知识点-24"><a href="#1-知识点-24" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>已知的是，row_number() 是生成不重复的序号，dense_rank() 生成组内排名，对于相同的值，排名是相同的。</p>
<p>题中，对 over() 内有时候只会使用 <code>order by</code> 进行全局排序，在对 uid 生成序号的时候，<code>rate</code> 相同时会产生并列的排名，这对获取前50%用户的题意来说，会产生歧义：只要包括在3以内的排名，都可以获取。但实际上是只取三个的意思。</p>
<h3 id="2-具体代码-21"><a href="#2-具体代码-21" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 近三个月</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,date_format(start_time, &quot;%Y%m&quot;) mt</span><br><span class="line">       ,<span class="built_in">count</span>(start_time) total_cnt</span><br><span class="line">       ,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> submit_time <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span>) complete_cnt</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,start_time</span><br><span class="line">       ,submit_time</span><br><span class="line">       ,<span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> uid <span class="keyword">order</span> <span class="keyword">by</span> date_format(start_time, &quot;%Y%m&quot;) <span class="keyword">desc</span>) rank2</span><br><span class="line"><span class="keyword">from</span> exam_record</span><br><span class="line"><span class="keyword">where</span> uid <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line"># <span class="number">50</span><span class="operator">%</span><span class="number">6</span>级和<span class="number">7</span>级用户</span><br><span class="line"><span class="keyword">select</span> uid <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,<span class="built_in">count</span>(uid) <span class="keyword">over</span>() tot_uid</span><br><span class="line">       ,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> rate <span class="keyword">desc</span>) rank1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"># <span class="keyword">SQL</span>试卷上未完成率</span><br><span class="line"><span class="keyword">select</span> uid</span><br><span class="line">       ,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> submit_time <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="operator">/</span> <span class="built_in">count</span>(start_time) rate</span><br><span class="line"><span class="keyword">from</span> exam_record </span><br><span class="line"><span class="keyword">where</span> exam_id <span class="keyword">in</span> (<span class="keyword">select</span> exam_id <span class="keyword">from</span> examination_info <span class="keyword">where</span> tag <span class="operator">=</span> &quot;SQL&quot;)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> uid</span><br><span class="line">)A</span><br><span class="line">)A </span><br><span class="line"><span class="keyword">where</span> rank1 <span class="operator">&lt;=</span> <span class="built_in">ceiling</span>(tot_uid <span class="operator">/</span> <span class="number">2</span>) </span><br><span class="line"><span class="keyword">and</span> uid <span class="keyword">in</span> (<span class="keyword">select</span> uid <span class="keyword">from</span> user_info <span class="keyword">where</span> level <span class="keyword">in</span> (<span class="number">6</span>, <span class="number">7</span>))</span><br><span class="line">)</span><br><span class="line">)A <span class="keyword">where</span> rank2 <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> uid, mt</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> uid, mt</span><br></pre></td></tr></table></figure>



<h2 id="百分比-和-排名函数的类型问题"><a href="#百分比-和-排名函数的类型问题" class="headerlink" title="百分比 和 排名函数的类型问题"></a>百分比 和 排名函数的类型问题</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/13415dff75784a57bedb6d195262be7b?tpId=240&tqId=2183409&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL32</strong> <strong>试卷完成数同比2020年的增长率及排名变化</strong></a></p>
<h3 id="1-知识点-25"><a href="#1-知识点-25" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>想要获取 <code>1 / 5</code> 的百分比参数，并保留一位小数，可以这样写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONCAT(round(<span class="number">1</span> <span class="operator">/</span> <span class="number">5</span> <span class="operator">*</span> <span class="number">100</span>, <span class="number">1</span>), <span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>排名函数如 <code>rank()</code> 生成的排名值的类型是 <code>bigint unsigned</code> ，也就是表示，如果要对这些元素进行加减乘除的运算，需要保证结果必须是非负数，否则会报错。可以使用 <code>cast(value as signed)</code> 进行类型转换。</p>
<h3 id="2-具体代码-22"><a href="#2-具体代码-22" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tag</span><br><span class="line">       ,exam_cnt_20</span><br><span class="line">       ,exam_cnt_21</span><br><span class="line">       ,CONCAT(round((exam_cnt_21 <span class="operator">-</span> exam_cnt_20) <span class="operator">/</span> exam_cnt_20 <span class="operator">*</span> <span class="number">100</span>, <span class="number">1</span>), <span class="string">&#x27;%&#x27;</span>) growth_rate</span><br><span class="line">       ,rank1 exam_cnt_rank_20</span><br><span class="line">       ,rank2 exam_cnt_rank_21</span><br><span class="line">       ,<span class="built_in">cast</span>(rank2 <span class="keyword">as</span> signed) <span class="operator">-</span> <span class="built_in">cast</span>(rank1 <span class="keyword">as</span> signed) rank_delta</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> tag</span><br><span class="line">       ,exam_cnt_20</span><br><span class="line">       ,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> exam_cnt_20 <span class="keyword">desc</span>) rank1</span><br><span class="line">       ,exam_cnt_21</span><br><span class="line">       ,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> exam_cnt_21 <span class="keyword">desc</span>) rank2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"># <span class="number">2021</span>年上半年 和 <span class="number">2020</span>年上半年</span><br><span class="line"><span class="keyword">select</span> B.tag</span><br><span class="line">       ,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> yt <span class="operator">=</span> <span class="number">2020</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>) exam_cnt_20</span><br><span class="line">       ,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> yt <span class="operator">=</span> <span class="number">2021</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>) exam_cnt_21</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> exam_id, <span class="keyword">year</span>(submit_time) yt <span class="keyword">from</span> exam_record </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(submit_time) <span class="keyword">in</span> (<span class="number">2021</span>, <span class="number">2020</span>) <span class="keyword">and</span> <span class="keyword">MONTH</span>(submit_time) <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">6</span></span><br><span class="line">)A <span class="keyword">inner</span> <span class="keyword">join</span> examination_info B <span class="keyword">using</span>(exam_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> B.tag</span><br><span class="line">)A</span><br><span class="line">)A <span class="keyword">where</span> exam_cnt_20 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> exam_cnt_21 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> growth_rate <span class="keyword">desc</span>, exam_cnt_rank_21 <span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h2 id="ifnull和-limit…offset…-的使用"><a href="#ifnull和-limit…offset…-的使用" class="headerlink" title="ifnull和 limit…offset… 的使用"></a>ifnull和 limit…offset… 的使用</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-highest-salary/">176. 第二高的薪水</a></p>
<h3 id="1-知识点-26"><a href="#1-知识点-26" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p><code>ifnull(val1, val2)</code> ：当 <code>val1</code> 为NULL，输出 <code>val2</code> 。</p>
<p><code>limit n1[, n2]</code>：<code>n1</code> 表示限制取多少行；如果使用 <code>n1, n2</code> 的形式则说明从 <code>n1</code> 行的写一行开始取 <code>n2</code> 行数据。</p>
<p><code>limit n1 offset n2</code> ：表示从 <code>n2</code> 行的下一行开始取 <code>n1</code> 行数据。</p>
<p>简单的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit <span class="number">2</span>; <span class="comment">-- 取前两行数据</span></span><br><span class="line">limit <span class="number">2</span>, <span class="number">3</span>; <span class="comment">-- 取3、4、5这三行的数据</span></span><br><span class="line">limit <span class="number">3</span> <span class="keyword">offset</span> <span class="number">4</span>; <span class="comment">-- 和 limit 2, 3 的结果一致</span></span><br></pre></td></tr></table></figure>

<h3 id="2-具体代码-23"><a href="#2-具体代码-23" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><p>​        题目中首先要求取第二大薪水的值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> salary <span class="keyword">from</span> Employee <span class="keyword">group</span> <span class="keyword">by</span> salary <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>​        接着要求如果没有第二大薪水就取 null 值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ifnull(</span><br><span class="line">    (<span class="keyword">select</span> salary </span><br><span class="line">     <span class="keyword">from</span> Employee </span><br><span class="line">     <span class="keyword">group</span> <span class="keyword">by</span> salary </span><br><span class="line">     <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> </span><br><span class="line">     limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span></span><br><span class="line">    ), <span class="keyword">NULL</span></span><br><span class="line">) <span class="keyword">as</span> SecondHighestSalary;</span><br><span class="line"><span class="comment">-- 或者更简单一点，因为取不到值本身就是null，不需要再判断一次</span></span><br><span class="line"><span class="keyword">select</span> (</span><br><span class="line">     <span class="keyword">select</span> salary </span><br><span class="line">     <span class="keyword">from</span> Employee </span><br><span class="line">     <span class="keyword">group</span> <span class="keyword">by</span> salary </span><br><span class="line">     <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> </span><br><span class="line">     limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">as</span> SecondHighestSalary;</span><br></pre></td></tr></table></figure>



<h2 id="group-by和partition-by的使用"><a href="#group-by和partition-by的使用" class="headerlink" title="group by和partition by的使用"></a>group by和partition by的使用</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/5f1cbe74c682485aa73e4c2b30f04a62?tpId=240&tqId=2183422&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL34</strong> <strong>每份试卷每月作答数和截止当月的作答总数。</strong></a></p>
<h3 id="1-知识点-27"><a href="#1-知识点-27" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p> <code>partition by</code> 在结果集上进行聚合，是逐条进行的，可以使用它来实现每月累加的操作。</p>
<p>group by进行聚合操作，会作用在分组下的所有记录。</p>
<h3 id="2-具体代码-24"><a href="#2-具体代码-24" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><p>​        首先实现前三个内容：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> exam_id</span><br><span class="line">       ,DATE_FORMAT(start_time, &quot;%Y%m&quot;) start_month</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="operator">*</span>) month_cnt</span><br><span class="line"><span class="keyword">from</span> exam_record</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> exam_id, start_month</span><br></pre></td></tr></table></figure>

<p>​        接着需要对 <code>month_cnt</code> 进行累加求和计算：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> exam_id</span><br><span class="line">       ,start_month</span><br><span class="line">       ,month_cnt</span><br><span class="line">       ,<span class="built_in">sum</span>(month_cnt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> exam_id <span class="keyword">order</span> <span class="keyword">by</span> start_month)</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> exam_id</span><br><span class="line">       ,DATE_FORMAT(start_time, &quot;%Y%m&quot;) start_month</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="operator">*</span>) month_cnt</span><br><span class="line"><span class="keyword">from</span> exam_record</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> exam_id, start_month</span><br><span class="line">)A</span><br></pre></td></tr></table></figure>



<h2 id="like和rlike"><a href="#like和rlike" class="headerlink" title="like和rlike"></a>like和rlike</h2><p>like的内容不是正则，而是通配符；rlike的内容是正则，写法与Java中的一致。</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/regexp/regexp-syntax.html">正则表达式 - 语法</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/2019-11-11/p/13827835.html">模糊查询like 通配符</a></p>
<h2 id="with-用法"><a href="#with-用法" class="headerlink" title="with 用法"></a>with 用法</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f72d3fc27dc14f3aae76ee9823ccca6b?tpId=240&tqId=2202378&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=240"><strong>SQL40</strong> <strong>根据指定记录是否存在输出不同情况</strong></a></p>
<h3 id="1-知识点-28"><a href="#1-知识点-28" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>​        把需要重复使用的sql语句放在 <code>with as</code> 里面，取一个别名，后面的查询就可以这个别名，这样对于大批量的sql语句起到一个优化的作用，而且清楚明了。类似于建临时表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> </span><br><span class="line">a <span class="keyword">as</span>(<span class="keyword">select</span> i, id <span class="keyword">from</span> cha),</span><br><span class="line">b <span class="keyword">as</span>(<span class="keyword">select</span> j, id <span class="keyword">from</span> cha)</span><br><span class="line"><span class="keyword">select</span> i, j <span class="keyword">from</span> a <span class="keyword">inner</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.id <span class="operator">=</span> b.id;</span><br></pre></td></tr></table></figure>



<h3 id="2-具体代码-25"><a href="#2-具体代码-25" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tmp <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> A.uid</span><br><span class="line">       ,A.level</span><br><span class="line">       ,<span class="built_in">coalesce</span>(incomplete_cnt, <span class="number">0</span>) incomplete_cnt</span><br><span class="line">       ,<span class="built_in">coalesce</span>(tot_cnt, <span class="number">0</span>) tot_cnt</span><br><span class="line">       ,<span class="built_in">coalesce</span>(round(incomplete_cnt <span class="operator">/</span> tot_cnt, <span class="number">3</span>), <span class="number">0</span>) incomplete_rate</span><br><span class="line"><span class="keyword">from</span> user_info A</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> uid</span><br><span class="line">       ,<span class="built_in">count</span>(<span class="operator">*</span>) tot_cnt</span><br><span class="line">       ,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> submit_time <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) incomplete_cnt</span><br><span class="line"><span class="keyword">from</span> exam_record <span class="keyword">group</span> <span class="keyword">by</span> uid)B</span><br><span class="line"><span class="keyword">on</span> A.uid <span class="operator">=</span> B.uid</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> uid, incomplete_cnt, incomplete_rate</span><br><span class="line"><span class="keyword">from</span> tmp </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">exists</span> (</span><br><span class="line">    <span class="keyword">select</span> uid, level <span class="keyword">from</span> tmp <span class="keyword">where</span> level <span class="operator">=</span> <span class="number">0</span> <span class="keyword">and</span> incomplete_cnt <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line">) <span class="keyword">and</span> level <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> uid, incomplete_cnt, incomplete_rate</span><br><span class="line"><span class="keyword">from</span> tmp</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">    <span class="keyword">select</span> uid <span class="keyword">from</span> tmp <span class="keyword">where</span> level <span class="operator">=</span> <span class="number">0</span> <span class="keyword">and</span> incomplete_cnt <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line">) <span class="keyword">and</span> tot_cnt <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> incomplete_rate</span><br></pre></td></tr></table></figure>



<h2 id="面试-连续n天怎么计算"><a href="#面试-连续n天怎么计算" class="headerlink" title="面试 - 连续n天怎么计算"></a>面试 - 连续n天怎么计算</h2><blockquote>
<p>表名：steps_table</p>
<p>字段：date - 日期（如20210101）, id - 用户id, steps - 步数</p>
<p>题目：求连续5天以上（包括5天）步数都在top3的用户。</p>
</blockquote>
<p>分段求解：</p>
<ol>
<li><p>先求出每天步数top3的用户和日期：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">order</span> <span class="keyword">by</span> steps <span class="keyword">desc</span>) r1 <span class="keyword">from</span> steps_table</span><br><span class="line">)A <span class="keyword">where</span> r1 <span class="operator">&lt;=</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>再对每个用户在其中所占的日期进行升序排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) r2 <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">order</span> <span class="keyword">by</span> steps <span class="keyword">desc</span>) r1 <span class="keyword">from</span> steps_table</span><br><span class="line">)A <span class="keyword">where</span> r1 <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">)A</span><br></pre></td></tr></table></figure>
</li>
<li><p>将日期减去排名，如果是连续的n天，减去连续的排名会是相同的日期，如20200102 - 1 day &#x3D; 20200101；20200103 - 2 day &#x3D; 20200101：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, date_sub(<span class="type">date</span>, <span class="type">interval</span> r2 <span class="keyword">day</span>) ds <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) r2 <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">order</span> <span class="keyword">by</span> steps <span class="keyword">desc</span>) r1 <span class="keyword">from</span> steps_table</span><br><span class="line">)A <span class="keyword">where</span> r1 <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">)A</span><br><span class="line">)A</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id和相减得到的日期分组计算个数，超过5个即满足条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, <span class="built_in">count</span>(<span class="operator">*</span>) c <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> id, date_sub(<span class="type">date</span>, <span class="type">interval</span> r2 <span class="keyword">day</span>) ds <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) r2 <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">order</span> <span class="keyword">by</span> steps <span class="keyword">desc</span>) r1 <span class="keyword">from</span> steps_table</span><br><span class="line">)A <span class="keyword">where</span> r1 <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">)A</span><br><span class="line">)A</span><br><span class="line">)A <span class="keyword">group</span> <span class="keyword">by</span> id, ds <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>最终得到结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> id, <span class="built_in">count</span>(<span class="operator">*</span>) c <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> id, date_sub(<span class="type">date</span>, <span class="type">interval</span> r2 <span class="keyword">day</span>) ds <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) r2 <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="type">date</span>, id, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">order</span> <span class="keyword">by</span> steps <span class="keyword">desc</span>) r1 <span class="keyword">from</span> steps_table</span><br><span class="line">)A <span class="keyword">where</span> r1 <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">)A</span><br><span class="line">)A</span><br><span class="line">)A <span class="keyword">group</span> <span class="keyword">by</span> id, ds <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">5</span></span><br><span class="line">)A</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="rows-n-preceding-x2F-following"><a href="#rows-n-preceding-x2F-following" class="headerlink" title="rows n preceding &#x2F; following"></a>rows n preceding &#x2F; following</h2><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f90ce4ee521f400db741486209914a11?tpId=268&tqId=2285070&ru=/exam/oj&qru=/ta/sql-factory-interview/question-ranking&sourceUrl=/exam/oj?tab=SQL%25E7%25AF%2587&topicId=268"><strong>SQL5</strong> <strong>国庆期间每类视频点赞量和转发量</strong></a></p>
<h3 id="1-知识点-29"><a href="#1-知识点-29" class="headerlink" title="1. 知识点"></a>1. 知识点</h3><p>rows n preceding：向前取n行，包括本行，也可以写成 <code>rows between current row and 6 preceding</code> ；</p>
<p>rows n following：向后取n行，包括本行，也可以写成 <code>rows between current row and 6 following</code> 。</p>
<h3 id="2-具体代码-26"><a href="#2-具体代码-26" class="headerlink" title="2. 具体代码"></a>2. 具体代码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> tag</span><br><span class="line">       ,dt</span><br><span class="line">       ,<span class="built_in">sum</span>(like_cnt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> tag <span class="keyword">order</span> <span class="keyword">by</span> dt <span class="keyword">rows</span> <span class="number">6</span> preceding)</span><br><span class="line">       ,<span class="built_in">max</span>(retweet_cnt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> tag <span class="keyword">order</span> <span class="keyword">by</span> dt <span class="keyword">rows</span> <span class="number">6</span> preceding)  </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> B.tag tag</span><br><span class="line">       ,date_format(A.start_time, &quot;%Y-%m-%d&quot;) dt</span><br><span class="line">       ,<span class="built_in">sum</span>(if_like) like_cnt</span><br><span class="line">       ,<span class="built_in">sum</span>(if_retweet) retweet_cnt</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> uid, video_id, start_time, if_like, if_retweet </span><br><span class="line"><span class="keyword">from</span> tb_user_video_log </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(start_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">)A <span class="keyword">inner</span> <span class="keyword">join</span> tb_video_info B <span class="keyword">using</span> (video_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> B.tag, date_format(A.start_time, &quot;%Y-%m-%d&quot;)</span><br><span class="line">)A</span><br><span class="line">)A</span><br><span class="line"><span class="keyword">where</span> dt <span class="keyword">between</span> <span class="string">&#x27;2021-10-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2021-10-03&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> tag <span class="keyword">desc</span>, dt</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	  
	
	 <div>
		<div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
	 </div>
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/sql/" rel="tag"># sql</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/07/08/LeetCode-NC15-%E6%B1%82%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/" rel="prev" title="LeetCode - NC15 求二叉树的层序遍历">
      <i class="fa fa-chevron-left"></i> LeetCode - NC15 求二叉树的层序遍历
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/09/LeetCode-NC68-%E8%B7%B3%E5%8F%B0%E9%98%B6/" rel="next" title="LeetCode - NC68 跳台阶">
      LeetCode - NC68 跳台阶 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%88%86%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0"><span class="nav-number">1.</span> <span class="nav-text">获取每一个分组中的最大元素</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="nav-number">1.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E9%A2%98%E8%A7%A3"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. 具体题解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97"><span class="nav-number">2.</span> <span class="nav-text">数值计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="nav-number">2.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-1"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%BA%8F%E5%8F%B7"><span class="nav-number">3.</span> <span class="nav-text">生成序号</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82%E8%A7%A3%E6%80%9D%E8%B7%AF"><span class="nav-number">3.1.</span> <span class="nav-text">求解思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-2"><span class="nav-number">3.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E9%9B%86"><span class="nav-number">4.</span> <span class="nav-text">并集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-2"><span class="nav-number">4.1.</span> <span class="nav-text">解题思路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#insert-ignore-%E5%92%8C-replace-into"><span class="nav-number">5.</span> <span class="nav-text">insert ignore 和 replace into</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-3"><span class="nav-number">5.1.</span> <span class="nav-text">解题思路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">6.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-4"><span class="nav-number">6.1.</span> <span class="nav-text">解题思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-3"><span class="nav-number">6.2.</span> <span class="nav-text">1. 知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-2"><span class="nav-number">6.2.1.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">7.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-5"><span class="nav-number">7.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-4"><span class="nav-number">7.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%A0%81"><span class="nav-number">7.1.2.</span> <span class="nav-text">2. 具体解决代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="nav-number">8.</span> <span class="nav-text">强制使用索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-6"><span class="nav-number">8.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-5"><span class="nav-number">8.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-3"><span class="nav-number">8.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E5%B7%B2%E6%9C%89%E8%A1%A8%E6%96%B0%E5%BB%BA%E5%88%97"><span class="nav-number">9.</span> <span class="nav-text">给已有表新建列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-7"><span class="nav-number">9.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-6"><span class="nav-number">9.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-4"><span class="nav-number">9.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">10.</span> <span class="nav-text">触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-8"><span class="nav-number">10.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-7"><span class="nav-number">10.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-5"><span class="nav-number">10.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%91%98%E8%87%AA"><span class="nav-number">10.1.3.</span> <span class="nav-text">3. 摘自</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E7%9A%84%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4"><span class="nav-number">11.</span> <span class="nav-text">表的更新和删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-9"><span class="nav-number">11.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-8"><span class="nav-number">11.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-6"><span class="nav-number">11.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#alter%E5%92%8Cupdate"><span class="nav-number">12.</span> <span class="nav-text">alter和update</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-10"><span class="nav-number">12.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-9"><span class="nav-number">12.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-7"><span class="nav-number">12.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#group-concat"><span class="nav-number">13.</span> <span class="nav-text">group_concat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-11"><span class="nav-number">13.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-10"><span class="nav-number">13.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-8"><span class="nav-number">13.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5"><span class="nav-number">14.</span> <span class="nav-text">分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-12"><span class="nav-number">14.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-11"><span class="nav-number">14.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-limit%E8%BF%9B%E8%A1%8C%E5%88%86%E9%A1%B5"><span class="nav-number">14.1.2.</span> <span class="nav-text">1. limit进行分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-row-number%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-number">14.1.3.</span> <span class="nav-text">2. row_number实现分页查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">15.</span> <span class="nav-text">切分字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-13"><span class="nav-number">15.1.</span> <span class="nav-text">解题思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-12"><span class="nav-number">15.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-9"><span class="nav-number">15.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E4%B8%AD%E8%AE%B0%E5%BD%95%E6%9B%BF%E6%8D%A2"><span class="nav-number">16.</span> <span class="nav-text">表中记录替换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-13"><span class="nav-number">16.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-10"><span class="nav-number">16.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E7%9B%B8%E5%87%8F"><span class="nav-number">17.</span> <span class="nav-text">日期相减</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-14"><span class="nav-number">17.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-11"><span class="nav-number">17.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E4%B8%AD%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%E5%B9%B6%E9%87%8D%E7%BD%AE%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE"><span class="nav-number">18.</span> <span class="nav-text">删除表中所有记录并重置自增主键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-15"><span class="nav-number">18.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-12"><span class="nav-number">18.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E5%92%8C%E5%94%AF%E4%B8%80%E9%94%AE"><span class="nav-number">19.</span> <span class="nav-text">创建自增主键和唯一键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-16"><span class="nav-number">19.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-13"><span class="nav-number">19.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%8C%B9%E9%85%8D"><span class="nav-number">20.</span> <span class="nav-text">日期匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-17"><span class="nav-number">20.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-14"><span class="nav-number">20.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#some%E3%80%81all%E3%80%81any%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-number">21.</span> <span class="nav-text">some、all、any的用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-18"><span class="nav-number">21.1.</span> <span class="nav-text">1. 知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#all%EF%BC%9A"><span class="nav-number">21.1.1.</span> <span class="nav-text">all：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tips"><span class="nav-number">21.1.1.1.</span> <span class="nav-text">tips</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#any%EF%BC%9A"><span class="nav-number">21.1.2.</span> <span class="nav-text">any：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tips%EF%BC%9A"><span class="nav-number">21.1.2.1.</span> <span class="nav-text">tips：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#some%EF%BC%9A"><span class="nav-number">21.1.3.</span> <span class="nav-text">some：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-15"><span class="nav-number">21.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#over-%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">22.</span> <span class="nav-text">over() 函数的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-19"><span class="nav-number">22.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-16"><span class="nav-number">22.2.</span> <span class="nav-text">2. 具体代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%92%8C-sum-%E7%9A%84%E8%BF%9E%E7%94%A8"><span class="nav-number">22.2.1.</span> <span class="nav-text">和 sum()的连用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%92%8Cmin-%E7%9A%84%E8%BF%9E%E7%94%A8%EF%BC%8C%E5%92%8C-datediff%E5%87%BD%E6%95%B0%E7%9A%84%E5%B5%8C%E5%A5%97"><span class="nav-number">22.2.2.</span> <span class="nav-text">和min()的连用，和 datediff函数的嵌套</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">23.</span> <span class="nav-text">字符串函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0%EF%BC%88%E6%99%AE%E9%80%9A%E8%BF%9E%E6%8E%A5%E5%92%8C%E7%BB%84%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">23.1.</span> <span class="nav-text">字符串连接函数（普通连接和组内连接）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-20"><span class="nav-number">23.1.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-17"><span class="nav-number">23.1.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#left"><span class="nav-number">23.2.</span> <span class="nav-text">left()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-21"><span class="nav-number">23.2.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-18"><span class="nav-number">23.2.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A9%BA%E5%80%BC%E5%8C%B9%E9%85%8D"><span class="nav-number">23.3.</span> <span class="nav-text">空值匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-22"><span class="nav-number">23.3.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-19"><span class="nav-number">23.3.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E5%89%8Dn%E8%A1%8C%E6%88%96%E5%90%8En%E8%A1%8C"><span class="nav-number">24.</span> <span class="nav-text">获取当前行数据的前n行或后n行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-23"><span class="nav-number">24.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-20"><span class="nav-number">24.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#row-number-%E5%92%8C-dense-rank-%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">25.</span> <span class="nav-text">row_number() 和 dense_rank() 的选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-24"><span class="nav-number">25.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-21"><span class="nav-number">25.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BE%E5%88%86%E6%AF%94-%E5%92%8C-%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B%E9%97%AE%E9%A2%98"><span class="nav-number">26.</span> <span class="nav-text">百分比 和 排名函数的类型问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-25"><span class="nav-number">26.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-22"><span class="nav-number">26.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ifnull%E5%92%8C-limit%E2%80%A6offset%E2%80%A6-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">27.</span> <span class="nav-text">ifnull和 limit…offset… 的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-26"><span class="nav-number">27.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-23"><span class="nav-number">27.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#group-by%E5%92%8Cpartition-by%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">28.</span> <span class="nav-text">group by和partition by的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-27"><span class="nav-number">28.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-24"><span class="nav-number">28.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#like%E5%92%8Crlike"><span class="nav-number">29.</span> <span class="nav-text">like和rlike</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#with-%E7%94%A8%E6%B3%95"><span class="nav-number">30.</span> <span class="nav-text">with 用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-28"><span class="nav-number">30.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-25"><span class="nav-number">30.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95-%E8%BF%9E%E7%BB%ADn%E5%A4%A9%E6%80%8E%E4%B9%88%E8%AE%A1%E7%AE%97"><span class="nav-number">31.</span> <span class="nav-text">面试 - 连续n天怎么计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rows-n-preceding-x2F-following"><span class="nav-number">32.</span> <span class="nav-text">rows n preceding &#x2F; following</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9F%A5%E8%AF%86%E7%82%B9-29"><span class="nav-number">32.1.</span> <span class="nav-text">1. 知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81-26"><span class="nav-number">32.2.</span> <span class="nav-text">2. 具体代码</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bonnie"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Bonnie</p>
  <div class="site-description" itemprop="description">每天都要做个人啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">121</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-05 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bonnie</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
